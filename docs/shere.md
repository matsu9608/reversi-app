# リバーシ（オセロ）ウェブアプリケーション設計書

## 1. システム概要

### 1.1 目的
このシステムは、ブラウザ上でリバーシ（オセロ）ゲームをプレイするためのウェブアプリケーションです。プレイヤーはブラウザからアクセスし、対戦を行い、その履歴を確認することができます。

### 1.2 主要機能
- リバーシゲームのプレイ
- 対戦履歴の表示
- 有効な手の表示
- ゲーム結果の保存

## 2. システムアーキテクチャ

### 2.1 全体構成
このアプリケーションは、クライアント-サーバー型のウェブアプリケーションとして構築されています。

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│  クライアント  │ ←──→ │   サーバー   │ ←──→ │ データベース  │
│  (ブラウザ)   │      │  (Node.js)  │      │  (MySQL)   │
└─────────────┘      └─────────────┘      └─────────────┘
```

### 2.2 アーキテクチャパターン
このアプリケーションは、クリーンアーキテクチャに基づいて設計されています。これにより、ビジネスロジック（ドメインモデル）をインフラストラクチャやフレームワークから分離し、テスト容易性や保守性を向上させています。

```
┌───────────────┐
│  プレゼンテーション │
│    (Webサーバー)  │
└────────┬──────┘
         ↓
┌────────┴──────┐
│   アプリケーション  │
│   (ユースケース)   │
└────────┬──────┘
         ↓
┌────────┴──────┐
│     ドメイン     │
│    (モデル)     │
└────────┬──────┘
         ↓
┌────────┴──────┐
│ インフラストラクチャ │
│   (データベース)   │
└───────────────┘
```

## 3. API仕様

以下はシステムのAPIエンドポイントです。

### 3.1 対戦履歴の取得
- エンドポイント: `GET /api/games`
- 説明: これまでのゲームの対戦履歴を取得します
- レスポンス: 
  - 対戦履歴のリスト（日時、打った手の数、勝者など）

### 3.2 新規ゲームの開始
- エンドポイント: `POST /api/games`
- 説明: 新しいゲームを開始します
- レスポンス:
  - 201 Created: ゲームが作成されました

### 3.3 指定ターンの盤面取得
- エンドポイント: `GET /api/games/latest/turns/{turnCount}`
- 説明: 指定されたターン数の盤面情報を取得します
- パラメータ:
  - turnCount: ターン数（整数）
- レスポンス:
  - 盤面の状態（8x8の二次元配列）
  - 次に置く石の色
  - 勝者（ゲーム終了時）

### 3.4 石の配置
- エンドポイント: `POST /api/games/latest/turns`
- 説明: 盤面に石を置きます
- リクエストボディ:
  - turnCount: 現在のターン数
  - move: 置く石の情報（色、x座標、y座標）
- レスポンス:
  - 201 Created: 石が配置されました

### 3.5 有効な手の取得
- エンドポイント: `GET /api/games/latest/turns/{turnCount}/valid-moves`
- 説明: 指定されたターンで有効な手の一覧を取得します
- パラメータ:
  - turnCount: ターン数（整数）
- レスポンス:
  - 有効な手のリスト（色、x座標、y座標）

## 4. データベース設計

システムでは以下のテーブルを使用しています：

### 4.1 games テーブル
ゲームの基本情報を格納します。
- id: ゲームID（主キー）
- started_at: 開始日時

### 4.2 turns テーブル
各ターンの情報を格納します。
- id: ターンID（主キー）
- game_id: ゲームIDの外部キー
- turn_count: ターン数
- next_disc: 次に置く石の色
- end_at: ターン終了日時

### 4.3 moves テーブル
各手の情報を格納します。
- id: 手ID（主キー）
- turn_id: ターンIDの外部キー
- disc: 置いた石の色
- x: X座標
- y: Y座標

### 4.4 squares テーブル
盤面の各マス目の状態を格納します。
- id: ID（主キー）
- turn_id: ターンIDの外部キー
- x: X座標
- y: Y座標
- disc: 石の色

### 4.5 game_results テーブル
ゲーム結果を格納します。
- id: 結果ID（主キー）
- game_id: ゲームIDの外部キー
- winner_disc: 勝者の石の色
- end_at: ゲーム終了日時

### 4.6 ER図
```
┌─────────┐       ┌─────────┐       ┌──────────┐
│  games   │ ───→ │  turns   │ ───→ │   moves   │
└─────────┘       └─────────┘       └──────────┘
     ↓                  ↓
┌─────────┐       ┌─────────┐
│game_results│     │ squares  │
└─────────┘       └─────────┘
```

## 5. ドメインモデル

### 5.1 Disc（石）
石の種類を表す列挙型です。
- Empty: 空（値: 0）
- Dark: 黒（値: 1）
- Light: 白（値: 2）
- Wall: 壁（値: 3）- 内部計算用

### 5.2 Point（座標）
盤面上の座標を表すクラスです。
- x: X座標
- y: Y座標

### 5.3 Move（手）
プレイヤーの一手を表すクラスです。
- disc: 置いた石の種類
- point: 石を置いた座標

### 5.4 Board（盤面）
オセロの盤面を表すクラスです。
- discs: 8x8のマス目の状態
- 主要メソッド:
  - place: 石を置く
  - listFlipPoints: ひっくり返せる石の座標リストを取得
  - existValidMove: 有効な手があるかを判定
  - listValidMoves: 有効な手のリストを取得
  - count: 特定の色の石の数をカウント

### 5.5 Turn（ターン）
ゲームの一つのターンを表すクラスです。
- gameId: ゲームID
- turnCount: ターン番号
- nextDisc: 次に置く石の色
- move: このターンでの手
- board: このターン後の盤面
- endAt: 終了時刻

### 5.6 Game（ゲーム）
ゲーム全体を表すクラスです。
- id: ゲームID
- startedAt: 開始時刻

### 5.7 GameResult（ゲーム結果）
ゲームの結果を表すクラスです。
- gameId: ゲームID
- winnerDisc: 勝者の石の色
- endAt: 終了時刻

## 6. ユーザーインターフェース

### 6.1 メイン画面
- 対戦履歴の表示
- 「対戦する」ボタン

### 6.2 ゲーム画面
- オセロ盤
- 次の手番の表示
- 黒と白の石の数表示
- 有効な手のハイライト表示
- 「戻る」ボタン
- 「新しいゲーム」ボタン

## 7. 使用技術

### 7.1 フロントエンド
- HTML/CSS: ユーザーインターフェース構築
- JavaScript: フロントエンドロジック

### 7.2 バックエンド
- Node.js: サーバーサイドJavaScript実行環境
- Express: Webアプリケーションフレームワーク
- TypeScript: 型付きJavaScript

### 7.3 データベース
- MySQL: リレーショナルデータベース

### 7.4 開発ツール
- Docker: 開発環境のコンテナ化
- Nodemon: 開発中のソースコード変更の自動検知

## 8. 今後の拡張可能性

### 8.1 ユーザー管理機能
- ユーザー登録・ログイン機能
- ユーザー間の対戦履歴

### 8.2 オンライン対戦機能
- リアルタイムでの対戦機能
- マッチングシステム

### 8.3 AI対戦機能
- 難易度別のAI
- AIの思考プロセスの可視化

### 8.4 UI/UX改善
- レスポンシブデザインの強化
- アニメーション効果
- サウンドエフェクト

### 8.5 分析機能
- プレイパターンの分析
- 統計情報の表示

## 9. まとめ

本システムは、クリーンアーキテクチャを採用したリバーシ（オセロ）のウェブアプリケーションです。フロントエンドとバックエンドの分離、明確に定義されたAPIなど、拡張性と保守性に優れた設計を行っています。技術的にも、TypeScriptによる型安全性や、テストしやすい構造など、品質を確保するための工夫がなされています。今後の拡張により、さらに機能豊かなアプリケーションへと発展させることが可能です。 